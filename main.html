<html>
  <head>
    <link rel="icon" href="bird.png">
  </head>
  <body onload="draw();">
    <canvas id="tutorial" width="480" height="640" style="border: 1px solid black;"></canvas>
  </body>

  <script type="text/javascript">
    var canvas = document.getElementById("tutorial")
    var ctx = canvas.getContext("2d")
    var CANVAS_WIDTH = canvas.width 
    var CANVAS_HEIGHT = canvas.height 
    var GROUND_WIDTH = 37
    var GROUND_HEIGHT = 128 
    var BIRD_WIDTH = 40
    var BIRD_HEIGHT = 40
    var PIPE_WIDTH = 65
    var PIPE_HEIGHT = 200  
    var x = CANVAS_WIDTH / 2 - BIRD_WIDTH 
    var y = CANVAS_HEIGHT / 2 - BIRD_HEIGHT / 2
    var rotateAngle = 0 
    var count = 0
    var background = loadImage('background.png')
    var ground = loadImage('ground.png')
    var bird = loadImage('bird.png')

    function draw() {
      window.addEventListener('keydown', pressKeyHandler, false)
    }
    
    function pressUp() {
      if (y >= 5) {
        y -= 80 
        rotateAngle = -20
      }
    }

    function pressKeyHandler(event) {
      switch(event.keyCode) {
        // press Space
        case 32:
          pressUp()
          reDraw()
          break
      }
    }
    
    function reDraw() {
      this.ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT)
      this.ctx.drawImage(background, 0, 0, CANVAS_WIDTH, CANVAS_HEIGHT - GROUND_HEIGHT)
      this.drawGround()
      this.ctx.translate(x + BIRD_WIDTH / 2, y + BIRD_HEIGHT / 2)
      this.ctx.rotate(rotateAngle * Math.PI / 180)
      this.ctx.translate(-x - BIRD_WIDTH / 2, -y - BIRD_HEIGHT / 2)
      this.ctx.drawImage(bird, x, y, BIRD_WIDTH, BIRD_HEIGHT)
      this.ctx.setTransform(1, 0, 0, 1, 0, 0)
    } 

    function loadImage(filePath) {
      var img = new Image()
      img.src = filePath 
      return img 
    }

    function drawGround() {
      var offset = -count * 10 
      for (let i = 0; i < 14; i++) {
        this.ctx.drawImage(ground, 0 + i * GROUND_WIDTH + offset, CANVAS_HEIGHT - GROUND_HEIGHT, GROUND_WIDTH, GROUND_HEIGHT)
      }
      count += 1
      if (count >= 4) {
        count = 0
      }
    }

    var nIntervId = null
    function birdFallBegin() {
      nIntervId = setInterval(birdFall, 100);
    }

    function birdFall() {
      y += 20 
      rotateAngle += 8 
      if (rotateAngle >= 90) {
        rotateAngle = 90
      }  
      if (y >= CANVAS_HEIGHT - GROUND_HEIGHT - BIRD_HEIGHT / 2) {
        clearInterval(nIntervId)
      } else {
        reDraw()
      }
    }

    birdFallBegin()
  </script>  
</html>
